# B-2

计研三一

孙亚男

2020215223

sunyn20@mails.tsinghua.edu.cn



## 实验要求

实现 5 个行星围绕太阳运动的效果同时添加字体效果
1)	自己设定行星的运动轨道和大小以及纹理贴图；
2)	添加键盘交互控制（包括特殊按键和普通按键），如方向右键可以增大沿 X 轴旋转速度，方向左键降低沿 X 轴旋转速度；
3)	添加字体效果显示行星的名字，字体随着行星运动而运动。



## 实验原理

该实验需要实现在窗口中的二维图形绘制、纹理贴图、位置变换、键盘输入控制和字符绘制。故使用GLFW库创建窗口，使用GLAD管理函数指针，使用GLM库进行矩阵变换，使用SOIL库进行纹理加载，使用freetype库绘制字符。



## 实验步骤

1. 创建窗口
   
   - 参见习题课一 Lecture1.cpp窗口创建相关代码
2. 绘制图形
   - 参见习题课一 Lecture2.cpp绘制三角形相关代码
   - 由于各行星运动平面之间的夹角非常小，故可以看作所有行星均在一个平面内运动
   - 绘制若干个水平于xy平面的正方形作为行星
   - 为了程序美观，绘制一个较远处水平于xy平面的正方形并加入星空贴图
4. 图形平移
   - 参见习题课三 Lecture4.cpp平移相关代码
   - 对于不同的图形
     - 平移 glm::translate
   - 图形平移的坐标通过一系列天文学知识计算，包括如下参数
     - 半长轴
     - 半短轴
     - 偏心率
     - 近日点黄经度
     - 公转周期
     - 行星半径
     - ![1607429881800](C:/Users/80592/AppData/Roaming/Typora/typora-user-images/1607429881800.png)
4. 图形纹理贴图

   - 参见习题课四 Lecture6_2.cpp贴图相关代码
     - 设置uniform纹理变量用于从主程序中传入纹理
   - 为了呈现圆形的星球，选择了png透明背景的图片
5. 字符绘制
   - 参见习题课五 Lecture7.cpp字符绘制相关代码
   - 由于绘制方式与行星不同，需要新建顶点着色器和片段着色器
6. 键盘控制
   - 参见习题课四 Lecture5_4.cpp camera控制相关代码
   - 使用键盘↑和↓调节行星运动速度
   - 使用鼠标滚轮对画面进行缩放



## 实验效果

具体实验效果参见录屏，下图为录屏截图：

![1607091049243](C:/Users/80592/AppData/Roaming/Typora/typora-user-images/1607091049243.png)



![1607091071732](C:/Users/80592/AppData/Roaming/Typora/typora-user-images/1607091071732.png)



可以看出，行星绕太阳按各自的轨道和周期运动，行星的名字随着行星运动，同时可以使用键盘和鼠标进行交互控制。



## 实验环境

Visual Studio 2019

GLFW库 3.3.2

GLAD库

GLM库 0.9.6.3

Simple OpenGL Image Library（SOIL）库

FreeType库 2.10.1



## 实验遇到的问题

freetype库最开始无法正常使用，从2.9.1更新到github最新版本2.10.1后，问题解决。



行星半径和行星轨道大小无法合理放缩到同一窗口，只能在尽可能真实的情况下进行一些调整，使得除太阳外的五个行星大小彼此成比例，轨道彼此成比例，而将太阳的行星半径调小。



对鼠标滚动放缩没有设置上下限，使得放缩比例成为负数而导致图像和字符上下反转，后在控制函数中加入范围限制，同时对速度调整也加入了范围限制。