# B-5

计研三一

孙亚男

2020215223

sunyn20@mails.tsinghua.edu.cn



## 实验要求

实现简单的粒子效果-下雪
1)	实现下雪的粒子效果；
2)	粒子的大小不一，运动方向模拟雪花运动方向；
3)	开始时雪花较少，随着时间慢慢增多；
4)	自己设计或者网上下载一张雪花图片即可。



## 实验原理

该实验需要实现在窗口中的二维图形绘制、纹理贴图和位置变换。故使用GLFW库创建窗口，使用GLAD管理函数指针，使用GLM库进行矩阵变换，使用SOIL库进行纹理加载。



## 实验步骤

1. 创建窗口
   
   - 参见习题课一 Lecture1.cpp窗口创建相关代码
2. 绘制图形
   - 参见习题课一 Lecture2.cpp绘制三角形相关代码
   - 绘制一个水平于xz平面的正方形作为地面
   - 绘制若干个水平于xy平面的正方形作为雪花
4. 图形平移
   - 参见习题课三 Lecture4.cpp平移相关代码
   
   - 对于不同的图形
     - 平移 glm::translate
     
   - 图形平移的坐标通过随机函数在指定范围内计算
   
4. 图形纹理贴图

   - 贴图部分参见习题课四 Lecture6_2.cpp贴图相关代码
     - 设置uniform纹理变量用于从主程序中传入纹理
   - 为了雪花互相不遮挡，选择了png透明背景的图片
   - 为了增加多样性，使用texture数组引入5种雪花效果
5. 雪花粒子管理
   - 通过vector实现对雪花对象的管理
   - 对于落到地面以下的粒子，从容器中删掉
   - 根据当前场景中应有的粒子数，生成新的雪花
   - 场景中粒子数随时间增多，一段时间后达到平衡值



## 实验效果

具体实验效果参见录屏，下图为录屏截图：

![1607018753204](C:/Users/80592/AppData/Roaming/Typora/typora-user-images/1607018753204.png)



![1607018779191](C:/Users/80592/AppData/Roaming/Typora/typora-user-images/1607018779191.png)



![1607018810202](C:/Users/80592/AppData/Roaming/Typora/typora-user-images/1607018810202.png)



可以看出，雪花数量随着时间推移而增多。



## 实验环境

Visual Studio 2019

GLFW库 3.3.2

GLAD库

GLM库 0.9.6.3

Simple OpenGL Image Library（SOIL）库



## 实验遇到的问题

雪花的坐标是通过初始坐标和当前时间推算，但由于开始时没有存雪花的生成时间点，所以后续生成的雪花的坐标直接在地面以下，没有继续参与绘制，导致没有雪花继续落下。后加入GLfloat类型变量存储雪花生成时间点，使用初始坐标和时间差计算当前坐标，问题解决。